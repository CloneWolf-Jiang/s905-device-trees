name: Compile DTS Files
on: [push]
jobs:
  compile-dts:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4.0.0
      - name: Install DTC
        run: sudo apt-get install device-tree-compiler
      - name: Compile DTS to DTB
        run: find . -name "*.dts" -exec sh -c 'dtc -I dts -O dtb -o "${0%.dts}.dtb" "$0"' {} \;
      - name: Upload artifacts
        uses: actions/upload-artifact@v4-beta
        with:
          name: dtb-files
          path: "**/*.dtb"
          
      - name: Upload the Release
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ github.ref_name }}  # 动态获取当前tag名称
          artifacts: '**/*.dtb'  # 上传所有DTB文件
          allowUpdates: true
          removeArtifacts: false
          replacesArtifacts: true
          token: ${{ secrets.GITHUB_TOKEN }}
          body: |
            ### 自动编译测试
